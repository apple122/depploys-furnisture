{"ast":null,"code":"import _slicedToArray from\"H:/Apple-Funiture/Furnisture/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useState}from'react';import Script from\"react-load-script\";import axios from'axios';import{useLocation,useNavigate}from'react-router-dom';import{ContextCate}from'./ConCategory';import data from'./data';import swal from'sweetalert';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var OmiseCard;export default function Omise_open(props){var _APICUR$;var Navigate=useNavigate();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),APICUR=_useState2[0],setAPICUR=_useState2[1];useEffect(function(){axios.get(data.Mainurl+data.Currency).then(function(res){setAPICUR(res.data);});},[]);var location=useLocation();var _useState3=useState(location.state.item),_useState4=_slicedToArray(_useState3,1),item=_useState4[0];var _useState5=useState(location.state.Number),_useState6=_slicedToArray(_useState5,1),number=_useState6[0];var amountA=((item.v2sprice-(item.v2sprice-item.v2percent)*item.v2percent/100)*number/((_APICUR$=APICUR[0])===null||_APICUR$===void 0?void 0:_APICUR$.Currency)).toFixed(0);var handleLoadScript=function handleLoadScript(){OmiseCard=window.OmiseCard;OmiseCard.configure({publicKey:'pkey_test_5s9anns9sj9o4hmyddu',currency:'USD',frameLabel:'Furnisfure SHOP',submitLabel:'Pay NOW',buttonLabel:'Pay with Omise'});};var creditCardConfigure=function creditCardConfigure(){OmiseCard.configure({defaultPaymentMethod:'credit_card',otherPaymentMethods:[]});OmiseCard.configureButton(\"#credit-card\");OmiseCard.attach();};var HandleSubmit=function HandleSubmit(e){try{axios.post(data.Mainurl+data.POSTOMISE,{'token':e,'amount':amountA+'00'}).then(function(res){var _item$v1typeId;axios.post(data.Mainurl+data.POSTSALE,{\"Image\":props.arrimg,\"itemId\":item._id,\"v2Items\":item.v2Items,\"sellPercent\":item.v2percent,\"sellSize\":item.v2size,\"sellType\":(_item$v1typeId=item.v1typeId)===null||_item$v1typeId===void 0?void 0:_item$v1typeId.pro_type,\"sellColor\":item.v2color,\"sellQty\":number,\"sellbprice\":item.v2sprice,\"sellAmount\":amountA,\"Location\":props.arrlocations}).then(function(req){axios.patch(data.Mainurl+data.PATCHITEM+item._id,{\"v2qty\":item.v2qty-number}).then(function(res){swal(\"ການສຳລະເງີນສຳເລັດ!\",{icon:\"success\"}).then(function(willDelete){if(willDelete){Navigate('/POST',{state:req.data});// window.location.reload(false)\n}});});});});}catch(error){swal(\"ການສຳລະເງີນສຳເລັດ!\",{icon:\"error\"}).then(function(willDelete){if(willDelete){window.location.reload(false);}});}};var OmiseHandle=function OmiseHandle(){OmiseCard.open({amount:amountA+'00',onCreateTokenSuccess:function onCreateTokenSuccess(nonce){HandleSubmit(nonce);},onFormClosed:function onFormClosed(){/* Handler on form closure. */}});};var handleClick=function handleClick(e){e.preventDefault();OmiseHandle();creditCardConfigure();};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Script,{url:\"https://cdn.omise.co/omise.js\",onLoad:handleLoadScript}),/*#__PURE__*/_jsx(\"form\",{children:/*#__PURE__*/_jsx(\"div\",{id:\"credit-card\",type:\"button\",onClick:handleClick,children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"border text-[24px] px-3 py-1 bg-red-500 text-white\",children:\"\\u0E8D\\u0EB7\\u0E99\\u0E8D\\u0EB1\\u0E99\\u0E81\\u0EB2\\u0E99\\u0EAA\\u0EB1\\u0EC8\\u0E87\\u0E8A\\u0EB7\\u0EC9\"})})})]});}","map":{"version":3,"names":["React","useContext","useEffect","useState","Script","axios","useLocation","useNavigate","ContextCate","data","swal","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","OmiseCard","Omise_open","props","_APICUR$","Navigate","_useState","_useState2","_slicedToArray","APICUR","setAPICUR","get","Mainurl","Currency","then","res","location","_useState3","state","item","_useState4","_useState5","Number","_useState6","number","amountA","v2sprice","v2percent","toFixed","handleLoadScript","window","configure","publicKey","currency","frameLabel","submitLabel","buttonLabel","creditCardConfigure","defaultPaymentMethod","otherPaymentMethods","configureButton","attach","HandleSubmit","e","post","POSTOMISE","_item$v1typeId","POSTSALE","arrimg","_id","v2Items","v2size","v1typeId","pro_type","v2color","arrlocations","req","patch","PATCHITEM","v2qty","icon","willDelete","error","reload","OmiseHandle","open","amount","onCreateTokenSuccess","nonce","onFormClosed","handleClick","preventDefault","children","url","onLoad","id","type","onClick","className"],"sources":["H:/Apple-Funiture/Furnisture/src/Page/Users/Categories/Omise.open.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\r\nimport Script from \"react-load-script\";\r\nimport axios from 'axios'\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { ContextCate } from './ConCategory';\r\nimport data from './data';\r\nimport swal from 'sweetalert'\r\n\r\nlet OmiseCard;\r\n\r\nexport default function Omise_open(props) {\r\n\r\n    let Navigate = useNavigate()\r\n\r\n    const [APICUR, setAPICUR] = useState(0)\r\n    useEffect(() => {\r\n        axios.get(data.Mainurl + data.Currency).then((res) => {\r\n            setAPICUR(res.data)\r\n        })\r\n    }, [])\r\n\r\n    let location = useLocation()\r\n    const [item] = useState(location.state.item)\r\n    const [number] = useState(location.state.Number)\r\n\r\n    let amountA = ((((item.v2sprice - (((item.v2sprice - item.v2percent) * item.v2percent) / 100)) * number) / (APICUR[0]?.Currency)).toFixed(0));\r\n\r\n    const handleLoadScript = () => {\r\n        OmiseCard = window.OmiseCard\r\n        OmiseCard.configure({\r\n            publicKey: 'pkey_test_5s9anns9sj9o4hmyddu',\r\n            currency: 'USD',\r\n            frameLabel: 'Furnisfure SHOP',\r\n            submitLabel: 'Pay NOW',\r\n            buttonLabel: 'Pay with Omise'\r\n        });\r\n    }\r\n\r\n    const creditCardConfigure = () => {\r\n        OmiseCard.configure({\r\n            defaultPaymentMethod: 'credit_card',\r\n            otherPaymentMethods: []\r\n        });\r\n        OmiseCard.configureButton(\"#credit-card\");\r\n        OmiseCard.attach();\r\n    }\r\n\r\n    const HandleSubmit = (e) => {\r\n        try {\r\n            axios.post(data.Mainurl + data.POSTOMISE, {\r\n                'token': e,\r\n                'amount': (amountA+'00')\r\n            }).then((res) => {\r\n                axios.post(data.Mainurl + data.POSTSALE, {\r\n                    \"Image\": props.arrimg,\r\n                    \"itemId\": (item._id),\r\n                    \"v2Items\": (item.v2Items),\r\n                    \"sellPercent\": (item.v2percent),\r\n                    \"sellSize\": (item.v2size),\r\n                    \"sellType\": (item.v1typeId?.pro_type),\r\n                    \"sellColor\": (item.v2color),\r\n                    \"sellQty\": number,\r\n                    \"sellbprice\": item.v2sprice,\r\n                    \"sellAmount\": (amountA),\r\n                    \"Location\": props.arrlocations\r\n                }).then((req) => {\r\n                    axios.patch(data.Mainurl + data.PATCHITEM + item._id, {\r\n                        \"v2qty\": (item.v2qty - number)\r\n                    }).then((res) => {\r\n                        swal(\"ການສຳລະເງີນສຳເລັດ!\", {\r\n                            icon: \"success\",\r\n                        }).then((willDelete) => {\r\n                            if (willDelete) {\r\n                                Navigate('/POST', { state: req.data })\r\n                                // window.location.reload(false)\r\n                            }\r\n                        });\r\n                    })\r\n                })\r\n            })\r\n        } catch (error) {\r\n            swal(\"ການສຳລະເງີນສຳເລັດ!\", {\r\n                icon: \"error\",\r\n            }).then((willDelete) => {\r\n                if (willDelete) {\r\n                    window.location.reload(false)\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    const OmiseHandle = () => {\r\n        OmiseCard.open({\r\n            amount: (amountA + '00'),\r\n            onCreateTokenSuccess: (nonce) => {\r\n                HandleSubmit(nonce)\r\n            },\r\n            onFormClosed: () => {\r\n                /* Handler on form closure. */\r\n            },\r\n        })\r\n    }\r\n\r\n    const handleClick = (e) => {\r\n        e.preventDefault();\r\n        OmiseHandle()\r\n        creditCardConfigure();\r\n    }\r\n    return (\r\n        <>\r\n            <Script\r\n                url=\"https://cdn.omise.co/omise.js\"\r\n                onLoad={handleLoadScript}\r\n            />\r\n            <form>\r\n                <div\r\n                    id=\"credit-card\"\r\n                    type=\"button\"\r\n                    onClick={handleClick}\r\n                >\r\n                    <button type='submit' className='border text-[24px] px-3 py-1 bg-red-500 text-white'>ຍືນຍັນການສັ່ງຊື້</button>\r\n                </div>\r\n            </form>\r\n        </>\r\n\r\n    )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}